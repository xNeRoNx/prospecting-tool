# Header (Top Bar) Technical Documentation

This document explains the implementation of the header component (`Header.tsx`). For end‑user wording see the translation keys `infoHeaderTitle` and `infoHeaderDesc`.

## Responsibilities
1. Display application title.
2. Provide theme switcher (visual appearance / palette).
3. Provide language switcher with URL path synchronization.
4. Expose data management entry (separate documented module – intentionally not described here in detail).
5. Provide quick access to Support dialog (opening external support page in new tab).

## Component Structure
```
<header>
  Title (h1)
  Theme Select (SelectTrigger)
  Language Select (SelectTrigger)
  <DataManagement />
  Support Button (opens <SupportDialog />)
</header>
<SupportDialog /> (portal)
```

## State & Hooks
- `useLanguage()` → `{ language, setLanguage, t }`
- `useTheme()` → `{ currentTheme, setTheme, themes }`
- `useAppData()` → loading state to disable interactive controls when necessary.
- Local state: `showSupport` boolean (dialog visibility).

## Language Switching Logic
When a new language is selected:
1. Cast value to union `'en' | 'pl'`.
2. Update context via `setLanguage`.
3. Mutate browser history (no reload) to include language prefix in pathname.
   - It checks whether the first path segment is already a language code.
   - If yes: replace it; if not: prepend it.
   - Preserves existing `search` and `hash` segments.

### Rationale
Embedding language in URL allows direct sharing of localized views and enables potential static pre-rendering or CDN caching per locale later.

## Theme Switching Logic
The theme `Select` lists available themes from `themes` map (each theme object supplies a `nameKey` pointing to a translation for display). On change:
- Calls `setTheme(selectedThemeId)`.
- UI updates instantly because styling is presumably driven by CSS variables / class toggling in the theme provider (implementation outside this file).

## Support Dialog
- Triggered by a button with heart icon.
- `SupportDialog` component receives `open` and `onOpenChange` props.
- Actual external support action: `window.open('https://buymeacoffee.com/xneronx', '_blank')` inside dialog button.

## Accessibility Considerations
- Select components rely on underlying UI library (should ensure keyboard navigation, ARIA roles).
- Title uses `<h1>` for document hierarchy.
- Support dialog uses a proper modal semantics via shared `<Dialog>` component.

## Extension Ideas
| Area | Enhancement |
|------|------------|
| Language persistence | Store locale in localStorage to survive hard reloads (if not already done upstream). |
| Theme previews | Add swatches inside the list items. |
| Auto theme | Add system theme detection (prefers-color-scheme). |
| Analytics | Track theme / language changes (privacy aware). |
| Keyboard shortcuts | e.g., `Ctrl+L` cycle language, `Ctrl+T` cycle theme. |

## Error / Edge Cases
- If user manipulates URL manually removing locale segment: next language change will prepend one (safe fallback).
- Invalid theme key: `setTheme` should ignore or revert (handled upstream; not validated locally).

## Testing Suggestions
1. Selecting theme updates body/class (snapshot or DOM query test).
2. Language change updates first path segment (mock `window.history.replaceState`).
3. Support dialog opens and closes correctly (state toggle + focus trap test).
4. Disabled state when `isLoading` is true (Select + buttons disabled attribute asserted).

---
_Last updated: autogenerated documentation for header component._
